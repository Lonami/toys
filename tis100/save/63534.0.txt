@0
MOV DOWN NIL # N1
L1: MOV UP ACC
    MOV ACC DOWN
    JNZ L1
WT: MOV 0 RIGHT
L2: MOV DOWN ACC
    JLZ L1
    MOV ACC RIGHT
    JNZ L2
MOV RIGHT NIL
MOV DOWN NIL
L3: MOV RIGHT ACC
    MOV ACC DOWN
    JNZ L3
JMP WT

@1
## PICK MIN
# NM = NEW MIN
# ST = START
# DN = DONE
# PL = PULL
# SK = SKIP
# PS = PUSH
# FK = FAKE
MOV DOWN NIL
MOV LEFT NIL

@2
# N4
MOV RIGHT ACC
L1: SWP
    MOV RIGHT ACC
    MOV ACC DOWN
    JEZ DN
    SWP
    MOV ACC DOWN
    JRO DOWN
    MOV -1 RIGHT
    JMP L1
    MOV 1 RIGHT
    MOV DOWN RIGHT
    JMP L1
DN: MOV 3 RIGHT

@3
MOV -1 UP # N2
MOV 0 DOWN
LP: MOV UP ACC
    MOV ACC RIGHT
    MOV ACC RIGHT
    MOV ACC DOWN
    JNZ LP
JRO RIGHT
MOV RIGHT LEFT
MOV DOWN NIL
PL: MOV DOWN LEFT
    JRO LEFT
    MOV LEFT UP
    JMP PL
    MOV 0 UP

@4
ST: MOV 999 ACC#N3
LP: SAV
    SUB LEFT
    JGZ NM
    SWP
    JMP LP
NM: MOV LEFT ACC
    JNZ LP
DN: SWP
    MOV ACC DOWN
    JRO DOWN
    MOV 1 LEFT
    MOV DOWN LEFT
    JMP ST
    MOV -7 LEFT

@5
# N1 STREAMS INPUT
# & SAVES/RESTORES
# AS NEEDED.
#
# N2 SAVES & GIVES
# INPUT TO MIN ACC
# & RESTORES SKIPG
# THE MINIMUM VAL.
#
# N3 KEEP TRACK OF
# MINIMUM VALUE, &
# INSTRUCTS N2 OP.
MOV DOWN UP

@6
ST: MOV UP ACC #N5
    SAV
    SUB UP
    JEZ SK
PS: MOV 3 UP
    SWP
    MOV ACC UP
    JMP ST
SK: MOV 1 UP
FK: MOV UP ACC
    JEZ ST
    MOV UP NIL
    MOV 3 UP
    MOV ACC UP
    JMP FK

@7
# N6
# NOTIFIES 2 CLEAN
ST: MOV UP ACC
    SUB 999
    JNZ PS
    MOV 0 DOWN
    MOV 4 UP
    MOV NIL RIGHT
    MOV LEFT NIL
    MOV LEFT NIL
    JMP ST
PS: ADD 999
    MOV 1 UP
    MOV ACC UP
    MOV ACC DOWN

@8
# N4 REMEMBERS MIN
# AND FILTERS MINM
# FROM STREAM ONCE
#
# N5 CHEATS 2 ONLY
# FILTER THEM ONCE
#
# N6 EMITS OKVALUE
# UNLESS IT'S 999.
#
# REST IS SYNCHRON
#
# ALSO PULL ZEROES
# TO CLEAN STACKS.
MOV LEFT UP